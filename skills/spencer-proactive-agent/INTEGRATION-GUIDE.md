# Integration Guide
# Spencer Proactive Agent — Connecting to Your Existing Systems

## Overview

This guide walks through setting up the proactive agent's integrations with your current OpenClaw/Income Bot/Obsidian setup.

---

## 1. Discord Notifications

The proactive agent uses the existing OpenClaw Discord provider to send alerts to your channels.

### Setup

No configuration needed if:
- Discord is already connected in OpenClaw (it is — you're using it now)
- You want alerts to go to `#atlas` (your home base)

### Testing

Run a test alert:
```powershell
cd C:\Users\spenc\.openclaw\workspace\skills\spencer-proactive-agent\integrations
.\discord.ps1 -Message "Test alert — system check" -Level info
```

You should see an ℹ️ message appear in #atlas within a few seconds.

---

## 2. Obsidian Vault Sync

The proactive agent writes to files inside your workspace `memory/` directory. These are automatically synced by your existing `Sync-Memory.ps1` cron job (runs every 10 minutes).

**Important files that get synced:**
- `memory/working-buffer.md` — Danger zone conversation log
- `memory/topics/empire-metrics.md` — Income bot health reports
- `memory/topics/wellness-harmony.md` — System coordination checks
- `SESSION-STATE.md` — Active WAL logs (already synced)

**No action needed** — the sync script already picks up these files.

---

## 3. Income Bot Health Monitoring

The `empire-metrics.ps1` script reads from the income bot's health status.

### Prerequisites

The income bot must be running (or have run at least once) to generate:
```
C:\Users\spenc\.openclaw\workspace\income_bot\data\health\status.json
```

If this file doesn't exist yet, the health check will report "not installed" — that's okay until you activate the bot.

### Expected Status JSON Format

```json
{
  "healthy": true,
  "last_run": "2026-02-19T00:00:00",
  "articles_published": 47,
  "errors_last_24h": 0,
  "message": "All systems operational"
}
```

The proactive agent will:
- Read this file every 30 minutes
- Write a human-readable report to `memory/topics/empire-metrics.md`
- Send Discord alerts if `healthy: false` or errors > 0

---

## 4. Cron Job Installation

The proactive agent's scheduled tasks are defined in `cron-jobs.json` (generated by Kronos). Install them with:

```powershell
cd C:\Users\spenc\.openclaw\workspace\skills\spencer-proactive-agent\scheduling
.\install-cron.ps1
```

This will add all necessary cron jobs to OpenClaw.

### Job List

| Label | Schedule | Purpose |
|-------|----------|---------|
| `proactive-working-buffer` | Every 5 min | Monitor context %, log if >60% |
| `proactive-empire-health` | Every 30 min | Check income bot status |
| `proactive-daily-note-check` | Daily 8 AM | Verify yesterday's note exists |
| `proactive-weekly-metrics` | Sunday 10 AM | Compile empire stats summary |
| `proactive-monthly-review` | 1st of month 9 AM | Month review |
| `proactive-buffer-rotate` | Daily midnight | Archive old buffer |
| `proactive-wellness-harmony` | Every 30 min | Coordinate with self-care |

### Verification

```powershell
.\verify-cron.ps1
```

Shows all installed proactive jobs and their next run times.

### Uninstall

```powershell
.\uninstall-cron.ps1
```

Removes all proactive agent cron jobs cleanly.

---

## 5. Path Dependencies

All scripts assume these paths:
- Workspace: `C:\Users\spenc\.openclaw\workspace`
- Income Bot: `C:\Users\spenc\.openclaw\workspace\income_bot`
- Obsidian Vault: `C:\Users\spenc\Documents\Obsidian\Vaults\Atlas` (from USER.md)

If you relocate any of these, update the `-Workspace` and `-IncomeBotPath` parameters accordingly.

---

## 6. Testing Integration End-to-End

### Step 1: Working Buffer

```powershell
.\scripts\working-buffer.ps1 -Mode monitor -Force
```

Should create `memory/working-buffer.md` if not exists.

### Step 2: Empire Health

```powershell
.\scripts\empire-metrics.ps1
```

Should write `memory/topics/empire-metrics.md` and send Discord alert if income bot not present.

### Step 3: Check-in Generator

```powershell
.\scripts\proactive-checkin.ps1
```

Should send a message to #atlas (unless it's night time).

### Step 4: Wellness Harmony

```powershell
.\scripts\wellness-harmony.ps1
```

Should write `memory/topics/wellness-harmony.md`.

---

## 7. Troubleshooting

| Symptom | Likely Cause | Fix |
|---------|--------------|-----|
| "Channel not found" errors | OLYMPUS_INDEX.md missing or channel name typo | Verify file exists at workspace root; channel name case-sensitive (no #) |
| No alerts appearing | Discord provider disabled in OpenClaw config | Run `openclaw config.get` and check `channels.discord.enabled` |
| Health check always fails | income_bot/status.json missing | Start income bot at least once to generate status file |
| Buffer not rotating | Cron job not installed or disabled | Run `openclaw cron list` and check for `proactive-buffer-rotate` |
| Scripts can't find modules | Running from wrong directory | Always run scripts from within the skill directory or use absolute paths |

---

## 8. Advanced: Custom Webhook (Alternative to OpenClaw Discord)

If you prefer direct Discord webhooks (bypass OpenClaw message routing), edit `integrations/discord.ps1`:

Replace the `openclaw message send` call with:
```powershell
$webhookUrl = "https://discord.com/api/webhooks/YOUR/WEBHOOK/URL"
$payload = @{ content = $formattedMessage } | ConvertTo-Json
Invoke-RestMethod -Uri $webhookUrl -Method Post -Body $payload -ContentType "application/json"
```

But OpenClaw's built-in Discord integration is recommended because it respects your channel allowlist and governance.

---

## Next Steps

1. Install cron jobs (`scheduling/install-cron.ps1`)
2. Run test suite (`scripts/test-integrations.ps1` — create if needed)
3. Verify memory sync is already running (it should be)
4. Enable WAL protocol in your main agent (already part of OpenClaw core)
5. Start using! The agent will now proactively monitor and check in.

---

*Integration Guide v1.0 — Spencer-optimized*
